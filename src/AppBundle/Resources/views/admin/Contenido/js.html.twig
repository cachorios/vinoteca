<script type="text/javascript">
    var fieldCount = '{{ form.contenido | length }}';

    jQuery(document).ready(function () {
        $(document).on('click', '#add-new', function (e) {
            var strField = "appbundle_contenido_contenido___name___imagen";

            e.preventDefault();
            var fieldList = jQuery('#item_list_contenido_collection');
            var newWidget = fieldList.attr('data-prototype');
            newWidget = newWidget.replace(/__name__/g, fieldCount);

            var newLi = jQuery('<li></li>').html(newWidget);
            newLi.appendTo(fieldList);
            setImgTheme(strField.replace(/__name__/g, fieldCount));
            fieldCount++;
        });

        $(document).on('click', '.remove-list-item', function (e) {
            e.preventDefault();
            var collectionHolder = $($(this)).parents('li');
            collectionHolder.remove();
        });

        $(document).on('click', '.collection-collapsed', function (e) {
            e.preventDefault();
            var fieldset = $(this).parent();
            var legend = $(this);
            var span = legend.children('span');
            var div = fieldset.children('div.collapsible');

            if (div.css('display') == "none") {
                span.removeClass("glyphicon glyphicon-plus");
                span.addClass("glyphicon glyphicon-minus")
            } else {
                span.removeClass("glyphicon glyphicon-minus");
                span.addClass("glyphicon glyphicon-plus")
            }
            div.toggle();
        });

        $("#appbundle_contenido_imagens").fileinput({
            {#{% set imagen_src = ('entity.imagen' == null ? asset("images/default-image.png" ) : asset("uploads/categorias/" ~ 'entity.imagen'  )) %}#}

            initialPreview: ["<img src='{{ "imagen_src" }}' class='file-preview-image'>"],
            overwriteInitial: true,
            showUpload: false,
            showCaption: false,
            browseClass: "btn btn-primary btn-sm",
            fileType: "any",
            allowedFileTypes: ['image'],
            'allowedFileExtensions': ['jpg', 'png', 'gif'],
            uploadLabel: 'Subir',
            removeLabel: 'Quitar',
            browseLabel: 'Explorar'
        });

    })

    setImgTheme = function (tagName) {
        
        $("#"+tagName).fileinput({
            {#{% set imagen_src = ('entity.imagen' == null ? asset("images/default-image.png" ) : asset("uploads/categorias/" ~ 'entity.imagen'  )) %}#}

            initialPreview: ["<img src='{{ "imagen_src" }}' class='file-preview-image'>"],
            overwriteInitial: true,
            showUpload: false,
            showCaption: false,
            browseClass: "btn btn-primary btn-sm",
            fileType: "any",
            allowedFileTypes: ['image'],
            'allowedFileExtensions': ['jpg', 'png', 'gif'],
            uploadLabel: 'Subir',
            removeLabel: 'Quitar',
            browseLabel: 'Explorar'
        });
    }

</script>

